# データ管理設計

## 概要
絵本生成に使用するキャラクター、ステージ、メッセージのデータを効率的に管理し、量子アニーリングやAIによる処理に適した形式で保存・利用するための設計書です。

## データ構造

### キャラクターデータ
```json
{
  "id": "CHAR_001",
  "name": "子（ねずみ）",
  "reading": "ねずみ",
  "category": "干支",
  "attributes": {
    "personality": ["賢い", "機敏", "好奇心旺盛"],
    "features": ["小さな体", "長い尻尾", "キラキラした目"],
    "skills": ["探検", "宝物探し", "知恵比べ"],
    "favorites": ["チーズ", "本", "冒険"],
    "habitat": "古い図書館の書棚の間"
  },
  "vectors": {
    "personality_embedding": [...],  // 性格のベクトル表現
    "image_embedding": [...],        // 特徴のベクトル表現
    "context_embedding": [...]       // 文脈のベクトル表現
  }
}
```

### ステージデータ
```json
{
  "id": "STAGE_001",
  "name": "海（うみ）",
  "category": "水辺",
  "attributes": {
    "features": ["青く広がる水平線", "白い砂浜", "揺れる波"],
    "timeVariations": {
      "morning": ["朝日に輝く波", "目覚める海鳥", "新鮮な潮風"],
      "noon": ["キラキラ光る水面", "遊ぶ魚たち", "暖かな砂浜"],
      "evening": ["オレンジ色の水平線", "帰る漁船", "静かになる波"],
      "night": ["月明かりの海面", "光る波しぶき", "星空の反射"]
    },
    "creatures": ["カモメ", "イルカ", "カニ", "ヒトデ"],
    "seasonalChanges": {
      "spring": ["穏やかな波", "渡り鳥の訪れ"],
      "summer": ["活発な波", "色とりどりの貝殻"],
      "autumn": ["白波立つ波", "渡り鳥の別れ"],
      "winter": ["荒々しい波", "冬の海鳥"]
    }
  },
  "vectors": {
    "scene_embedding": [...],        // 場面のベクトル表現
    "atmosphere_embedding": [...],    // 雰囲気のベクトル表現
    "context_embedding": [...]       // 文脈のベクトル表現
  }
}
```

### メッセージデータ
```json
{
  "id": "MSG_001",
  "category": "愛情・感謝",
  "content": "生まれてきてくれて、ありがとう",
  "attributes": {
    "scene": ["誕生の瞬間", "家族との出会い"],
    "emotions": ["喜び", "感動", "感謝"],
    "developments": [
      "待ち望んでいた君との出会い",
      "家族みんなの幸せな気持ち",
      "新しい命の誕生の喜び"
    ]
  },
  "vectors": {
    "emotion_embedding": [...],      // 感情のベクトル表現
    "context_embedding": [...],      // 文脈のベクトル表現
    "message_embedding": [...]       // メッセージ全体のベクトル表現
  }
}
```

## ベクトル化手法

### 1. テキストのベクトル化
- 手法：Sentence-BERTやFastTextなどの日本語に対応した言語モデルを使用
- 目的：
  - キャラクターの性格や特徴の類似性計算
  - ステージの雰囲気や特徴の類似性計算
  - メッセージの感情や文脈の類似性計算

### 2. イメージのベクトル化
- 手法：VGGやResNetなどの事前学習済みモデルを使用
- 目的：
  - キャラクターの視覚的特徴の類似性計算
  - ステージの視覚的特徴の類似性計算

### 3. 感情のベクトル化
- 手法：感情分析モデルを使用
- 目的：
  - メッセージの感情的な類似性計算
  - ストーリーの感情的な流れの制御

## データベース設計

### 1. 主要テーブル
- characters: キャラクター情報
- stages: ステージ情報
- messages: メッセージ情報

### 2. ベクトルストア
- 高次元ベクトルの効率的な検索のため、Faissなどのベクトルデータベースを使用
- 類似度検索の高速化

### 3. メタデータ
- タグ付け情報
- 関連性情報
- 使用履歴

## QUBO設計への活用

### 1. 類似度行列の生成
- キャラクター間の類似度
- ステージ間の類似度
- メッセージ間の類似度

### 2. 制約条件の設定
- キャラクターとステージの相性
- メッセージとシーンの適合性
- ストーリーの流れの自然さ

### 3. 最適化目標
- ユーザー入力との整合性
- ストーリーの一貫性
- 感情の流れの適切さ

## 今後の拡張性

### 1. データの追加
- 新しいキャラクター
- 新しいステージ
- 新しいメッセージパターン

### 2. モデルの改善
- ベクトル化手法の改善
- 類似度計算方法の最適化
- QUBOパラメータの調整

### 3. 機能の拡張
- より複雑なストーリー生成
- インタラクティブな要素の追加
- マルチモーダルな表現の統合
